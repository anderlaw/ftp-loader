(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{1027:function(e,t,r){},1158:function(e,t,r){"use strict";r.r(t);r(282);var n=r(136),a=(r(133),r(91)),s=(r(109),r(42)),i=(r(212),r(53)),l=(r(89),r(14));function o(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},s=Object.keys(e);for(n=0;n<s.length;n++)r=s[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)r=s[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}function c(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}r(421);var d=r(280),u=r(15),f=r(16),h=r(17),p=r(13),m=r(18),y=(r(423),r(160)),b=(r(992),r(1005)),g=(r(134),r(48)),v=r(0),E=r.n(v),I=r(41),k=(r(1027),r(108)),R=g.a.Column,x=b.a.TreeNode,O=y.a.Item,w=function(e){function t(){var e,r;Object(u.a)(this,t);for(var n=arguments.length,a=new Array(n),s=0;s<n;s++)a[s]=arguments[s];return(r=Object(h.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(a)))).state={modal2Visible:!1,roleList:[],roleListOrigin:[],defaultExpandAll:!0,resModalVisible:!1,treeList:[],targetTree:[],targetExpandes:[],checkedKeys:[],roleResId:""},r.renderTreeNodes=function(e){return e.map(function(e){return e.children?E.a.createElement(x,{key:e.resId,title:e.resName,dataRef:e},r.renderTreeNodes(e.children)):E.a.createElement(x,{key:e.resId,title:e.resName,dataRef:e})})},r.onCheck=function(e,t){r.setState({checkedKeys:e});var n=t.checkedNodesPositions.map(function(e){return e.pos.split("-").slice(1).join("-")});r.renderTargetTree(n)},r}return Object(m.a)(t,e),Object(f.a)(t,[{key:"componentDidMount",value:function(){this.getRoleList(),this.getRelationRes()}},{key:"getRoleList",value:function(){var e=this;I.c.roleList().then(function(t){1===t.res&&e.setState({roleListOrigin:t.obj.roleInfos,roleList:t.obj.roleInfos.map(function(e){return e.roleName})})})}},{key:"sureBtnClick",value:function(){var e=this;(0,this.props.form.validateFields)(function(t,r){t||(I.c.addRoleInfo(r).then(function(t){1===t.res?(d.a.success("\u6dfb\u52a0\u6210\u529f"),e.getRoleList()):d.a.error("\u6dfb\u52a0\u5931\u8d25")}),e.setModal2Visible(!1))})}},{key:"getRelationRes",value:function(){var e=this;I.c.relationResList().then(function(t){1===t.res&&e.setState({treeList:t.obj})})}},{key:"getRoleRes",value:function(e){var t=this;I.c.roleRes({roleId:e}).then(function(e){if(1===e.res){var r=t.getAllResIdFromResData(e.obj.roleResList);t.setState({checkedKeys:r}),t.setState({targetTree:e.obj.roleResList})}})}},{key:"getAllResIdFromResData",value:function(e){var t=[],r=[];if(!Array.isArray(e))throw"argument must array";return function e(n){n.forEach(function(n){Array.isArray(n.children)&&n.children.length>0&&(r.push(n.resId),e(n.children)),null!=n.parentId&&t.push(n.resId)})}(e),this.setState({targetExpandes:r}),t}},{key:"relationResBtn",value:function(e){this.setState({roleResId:e}),this.setResModalVisible(!0),this.getRoleRes(e),console.log(e)}},{key:"resBtnSure",value:function(){console.log("\u8d44\u6e90sure\uff1a",this.state.checkedKeys),this.setResModalVisible(!1),I.c.relationRes({roleId:this.state.roleResId,resId:this.state.checkedKeys}).then(function(e){console.log(e),1==e.res?d.a.success("\u5173\u8054\u6210\u529f"):d.a.error("\u5173\u8054\u5931\u8d25")})}},{key:"setModal2Visible",value:function(e){var t=this.props.form.resetFields;this.setState({modal2Visible:e}),t()}},{key:"setResModalVisible",value:function(e){this.setState({resModalVisible:e})}},{key:"renderTargetTree",value:function(e){var t=[],r=[],n=[],a=JSON.parse(JSON.stringify(this.state.treeList));e.forEach(function(e){var s=e.split("-");switch(s.length){case 1:t.push(a[s[0]].resId);break;case 2:t.push(a[s[0]].resId),r.push(a[s[0]].children[s[1]].resId);break;case 3:t.push(a[s[0]].resId),r.push(a[s[0]].children[s[1]].resId),n.push(a[s[0]].children[s[1]].children[s[2]].resId)}}),n=c(new Set(n)),r=c(new Set(r)),n=c(new Set(n));var s=function(e){var t=[],r=[],n=[];function a(e){var s=e.resType;if(1==s){e.children;var i=o(e,["children"]);t.push(i)}else if(2==s){e.children;var l=o(e,["children"]);r.push(l)}else if(3==s){e.children;var c=o(e,["children"]);n.push(c)}Array.isArray(e.children)&&e.children.forEach(function(e){a(e)})}return Array.isArray(e)?e.forEach(function(e){a(e)}):a(e),{typeNodes:t,pageNodes:r,fnNodes:n}}(a),i=s.typeNodes,l=s.pageNodes,d=s.fnNodes,u=i.filter(function(e){return t.find(function(t){return t==e.resId})}),f=l.filter(function(e){return r.find(function(t){return t==e.resId})}),h=d.filter(function(e){return e.children=[],n.find(function(t){return t==e.resId})});f.forEach(function(e){var t=e.resId;e.children=h.filter(function(e){return e.parentId==t})}),u.forEach(function(e){var t=e.resId;e.children=f.filter(function(e){return e.parentId==t})}),this.setState({targetTree:u,targetExpandes:t.concat(n).concat(r)})}},{key:"render",value:function(){var e=this,t=this.props.form.getFieldDecorator,r={labelCol:{xs:{span:24},sm:{span:4}},wrapperCol:{xs:{span:24},sm:{span:20}}};return E.a.createElement("div",null,E.a.createElement(i.a,{separator:">"},E.a.createElement(l.a,{type:"pushpin"}),E.a.createElement(i.a.Item,null,"\u6743\u9650\u8bbe\u7f6e"),E.a.createElement(i.a.Item,null,"\u89d2\u8272\u8d44\u6e90\u7ba1\u7406")),E.a.createElement("div",{className:"content-box"},E.a.createElement(k.a,{right:E.a.createElement(s.a,{icon:"plus",className:"gradient-btn",onClick:function(){e.setModal2Visible(!0)}},"\u65b0\u589e\u89d2\u8272"),title:"\u89d2\u8272\u7ba1\u7406"},E.a.createElement(g.a,{bordered:!0,rowKey:"roleId",dataSource:this.state.roleListOrigin},E.a.createElement(R,{title:"\u89d2\u8272\u540d\u79f0",dataIndex:"roleName"}),E.a.createElement(R,{title:"\u89d2\u8272\u63cf\u8ff0",dataIndex:"roleDesc"}),E.a.createElement(R,{title:"\u521b\u5efa\u65f6\u95f4",dataIndex:"createDate"}),E.a.createElement(R,{title:"\u66f4\u65b0\u65f6\u95f4",dataIndex:"updateDate"}),E.a.createElement(R,{title:"\u64cd\u4f5c",render:function(t){return E.a.createElement("span",{onClick:function(){e.relationResBtn(t.roleId)},style:{color:"blue"},className:"pointer-icon"},"\u5173\u8054\u8d44\u6e90")}})))),E.a.createElement(n.a,{title:"\u65b0\u589e\u89d2\u8272",centered:!0,visible:this.state.modal2Visible,onOk:function(){e.sureBtnClick()},onCancel:function(){e.setModal2Visible(!1)},okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88"},E.a.createElement(y.a,null,E.a.createElement(O,Object.assign({label:"\u89d2\u8272\u540d\u79f0"},r),t("roleName",{rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u89d2\u8272\u540d\u79f0\uff01"},{max:20,message:"\u6700\u591a\u53ea\u80fd\u8f93\u516520\u4e2a\u5b57\u7b26"}]})(E.a.createElement(a.a,null))),E.a.createElement(O,Object.assign({},r,{label:"\u89d2\u8272\u63cf\u8ff0"}),t("roleDesc",{rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u89d2\u8272\u63cf\u8ff0\uff01"},{max:20,message:"\u6700\u591a\u53ea\u80fd\u8f93\u516520\u4e2a\u5b57\u7b26"}]})(E.a.createElement(a.a,null))))),E.a.createElement(n.a,{title:"\u8d44\u6e90\u9009\u6846",centered:!0,visible:this.state.resModalVisible,onOk:function(){e.resBtnSure()},onCancel:function(){e.setResModalVisible(!1)},okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88"},E.a.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"}},E.a.createElement("div",{style:{width:"45%"}},E.a.createElement(b.a,{checkable:!0,defaultExpandAll:this.state.defaultExpandAll,onCheck:function(t,r){e.onCheck(t,r)},checkedKeys:this.state.checkedKeys},this.renderTreeNodes(this.state.treeList))),E.a.createElement("div",{style:{width:"45%"}},E.a.createElement(b.a,{expandedKeys:this.state.targetExpandes,defaultExpandAll:this.state.defaultExpandAll},this.renderTreeNodes(this.state.targetTree))))))}}]),t}(v.Component);t.default=y.a.create()(w)}}]);
//# sourceMappingURL=13.6691152d.chunk.js.map